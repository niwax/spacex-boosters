<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=800, initial-scale=1, shrink-to-fit=no">

    <title>SpaceX Booster List</title>

    <style type="text/css">
        html, body {
            width: 100%;
        }

        body {
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
            background-color: black;
            color: white;
            font-weight: normal;
            font-size: 0.9em;
        }

        #content {
            max-width: 800px;
            margin: auto;
        }

        a {
            color: white;
        }

        h1 {
            font-size: 1.9em;
        }

        .imprint {
            color: #777;
            font-size: 0.8em;
        }

        .imprint a {
            color: #999;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        li {
            margin: 5px 6px;
        }

        li.even {
            background-color: black;
        }

        li.odd {
            background-color: #211d1d;
        }

        li > span {
            height: 24px;
            line-height: 24px;
            vertical-align: middle;
            display: inline-block;
            position: relative;
        }

        li .heat {
            width: 24px;
            margin-right: 8px;
            margin-left: 3px;
        }

            li .heat .heat-indicator {
                position: absolute;
                top: 0;
                left: 0;
                width: 24px;
                height: 24px;
            }

                li .heat .heat-indicator img {
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    width: 24px;
                    height: 24px;
                }

                li .heat .heat-indicator span {
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    width: 24px;
                    height: 24px;
                    overflow: hidden;
                }

            li .heat .status-indicator {
                position: absolute;
                top: 12px;
                left: 12px;
                width: 16px;
                height: 16px;
                line-height: 12px;
                vertical-align: middle;
                text-align: center;
                background-color: #d00;
                border-radius: 8px;
                opacity: 0.8;
            }

        li .name {
            font-size: 1.4em;
            width: 120px;
        }

        li .mission {
            margin: 2px;
            padding: 2px 6px;
            height: 16px;
            border-radius: 8px;
            line-height: 16px;
            background-color: #050;
        }

        li .success-land {
            background-color: #450;
        }

        li .success-sea {
            background-color: #054;
        }

        li .failure {
            background-color: #700;
        }

        li .expended {
            background-color: #740;
        }

        li .tentative {
            background-color: #222;
            border: 1px dashed #888;
            color: #888;
        }

        .header {
            margin-bottom: 16px;
        }

        .header .heat {
            margin-left: 0;
            margin-right: 11px;
        }

        .header span {
            font-size: 1em;
        }

        .mission .description {
            display: none;
            position: absolute;
            top: 25px;
            left: 0;
            padding: 8px;
            border: 1px solid #555;
            border-radius: 8px;
            background-color: #222;
            width: 250px;
            z-index: 1000;
        }

        .mission:hover .description {
            display: block;
        }

        h6 {
            font-size: 1em;
            font-weight: bold;
            margin: 0;
        }

        p {
            margin: 0;
            margin-top: 4px;
        }

        .version {
            border-top: 1px dashed #555;
            color: #888;
            margin-left: 3px;
            margin-top: 10px;
            height: 1px;
            overflow: visible;
            text-align: right;
        }
    </style>

    <script type="text/javascript">
        function load() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    create(JSON.parse(xhttp.responseText));
                }
            };
            xhttp.open("GET", "https://cors.io/?https://api.spacexdata.com/v3/launches", true);
            xhttp.send();
        }

        function getLastDate(data) {
            var lastDate = "1";
            for (let i = 0; i < data.length; i++) {
                let date = data[i].launch_date_local.replace("T", " ").split("+")[0];
                if (date > lastDate) {
                    lastDate = date;
                }
            }
            return lastDate;
        }

        function getDateMs(dateStr) {
            let date = new Date();
            date.setFullYear(dateStr.slice(0,4), dateStr.slice(5,7), dateStr.slice(8,10));
            return date.getTime();
        }

        function create(data) {
            let estimates = {
                "B1001": "B1001 *",
                "B1002": "B1002 *",
                "B1003": "B1003 *",
                "B1004": "B1004 *",
                "B1005": "B1005 *",
                "B1006": "B1006 *",
                "B1007": "B1007 *",
                "B1008": "B1008 *",
                "Merlin1A": "Falcon 1-1 *",
                "Merlin2A": "Falcon 1-2 *",
                "Merlin1C": "Falcon 1-3 *",
                "Merlin2C": "Falcon 1-4 *",
                "Merlin3C": "Falcon 1-5 *"
            };

            let versions = {
                "B0003": "First Falcon 9 1.0",
                "B1003 *": "First Falcon 9 1.1",
                "B1019": "First Falcon 9 Full Thrust",
                "B1039": "First Falcon 9 FT Block 4",
                "B1046": "First Falcon 9 FT Block 5"
            };

            let html = "";

            let boosters = {};
            let energy = {
                "LEO": 1.0,
                "PO": 1.03,
                "SSO": 1.07,
                "ISS": 0.95,
                "MEO": 1.2,
                "GTO": 1.4,
                "ES-L1": 1.5,
                "HEO": 1.5,
                "HCO": 1.5
            };

            let maxenergy = 0;


            for (let i = 0; i < data.length; i++) {
                let flight = data[i];

                for (let j = 0; j < flight.rocket.first_stage.cores.length; j++) {
                    let stage = flight.rocket.first_stage.cores[j];
                    let booster = {
                        missions: [],
                        energy: 0,
                        available: true
                    };

                    let name = stage.core_serial;
                    if (name == null) continue;

                    if (estimates.hasOwnProperty(name)) {
                        name = estimates[name];
                    }

                    if (boosters.hasOwnProperty(name)) {
                        booster = boosters[name];
                    }

                    let mission = {
                        success: "expended"
                    };

                    mission.name = flight.mission_name;

                    booster.name = name;
                    mission.launcher = flight.rocket.rocket_name;
                    mission.date = flight.launch_date_local.replace("T", " ").split("+")[0];
                    mission.site = flight.launch_site.site_name;
                    mission.periapsis = flight.rocket.second_stage.payloads[0].orbit_params.periapsis_km;
                    mission.apoapsis = flight.rocket.second_stage.payloads[0].orbit_params.apoapsis_km;
                    mission.inclination = flight.rocket.second_stage.payloads[0].orbit_params.inclination_deg;
                    mission.mass = flight.rocket.second_stage.payloads[0].payload_mass_kg;
                    mission.orbit = flight.rocket.second_stage.payloads[0].orbit;
                    mission.energy = energy[mission.orbit];

                    if (!flight.launch_success) {
                        mission.success = "failure";
                    }

                    if (stage.land_success) {
                        if (stage.landing_type == "ASDS") {
                            mission.success = "success-sea";
                        }
                        else {
                            mission.success = "success-land";
                        }
                    }
                    else {
                        booster.available = false;
                    }

                    if (flight.is_tentative || flight.launch_success == null) {
                        mission.success = "tentative";
                        booster.available = true;
                    }

                    booster.energy += mission.energy;
                    booster.missions.push(mission);

                    if (maxenergy < booster.energy) maxenergy = booster.energy;

                    boosters[name] = booster;
                }
            }

            let lastDateStr = getLastDate(data);
            let lastDateMs = getDateMs(lastDateStr);
            let firstDateMs = getDateMs("2006-03-25");
            let alternate = "even";

            for (let name in boosters) {
                if (boosters.hasOwnProperty(name)) {
                    let booster = boosters[name];
                    alternate = (alternate=="even" ? "odd" : "even");
                    let _html = `
                        <li class="${alternate}">
                            <span class="heat">
                                <span class="heat-indicator">
                                    <img src="heat-bw.png" />
                                    <span style="height: ${booster.energy / maxenergy * 100}%">
                                        <img src="heat.png" />
                                    </span>
                                </span>
                                ${booster.available ? "" : '<span class="status-indicator">x</span>'}
                            </span>
                            <span class="name">${booster.name}</span>`;

                    let xCorrect = 0;
                    for (let i = 0; i < booster.missions.length; i++) {
                        let mission = booster.missions[i];
                        let missionDateMs = getDateMs(mission.date);
                        
                        _html += `
                            <div class="mission ${mission.success}" style="left:${
                                Math.round(600*(missionDateMs-firstDateMs)/(lastDateMs-firstDateMs)) - xCorrect
                                }px;display:inline-block;position:relative;">${mission.orbit}<span class="description">
                                    <h6>${mission.name}</h6>
                                    <p>Date: ${mission.date}</p>
                                    <p>Launcher: ${mission.launcher}</p>
                                    <p>Launch Pad: ${mission.site}</p>
                                    <p>Target Orbit: ${
                                            (mission.periapsis == undefined || mission.periapsis == 0) ?
                                            "unknown" :
                                            "" + Math.round(mission.periapsis) + "kmx" + Math.round(mission.apoapsis) + "km " + Math.round(mission.inclination) + "°"
                                        }</p>
                                    <p>Mass: ${
                                            (mission.mass == undefined) ?
                                            "unknown" :
                                            "" + mission.mass + "kg"
                                        }</p>
                                </span></div>`;
                           xCorrect += 40;
                    }
                    _html += "</li>";

                    if (versions.hasOwnProperty(name)) {
                        _html += `
                            <div class="version">${versions[name]}</div>`;
                    }

                    html = _html + html;
                }
            }

            html = `
                <li class="header">
                    <span class="heat">Toast</span>
                    <span class="name">Name</span>
                    <span>
                        Missions:
                        <span class="mission success-land">RTLS</span>
                        <span class="mission success-sea">ASDS</span>
                        <span class="mission expended">Expended</span>
                        <span class="mission failure">Failure</span>
                        <span class="mission tentative">Planned</span>
                        <span style="color: #777">Hover for more info</span>
                    </span>
                </li>` + html;

            document.getElementById("list").innerHTML = html;
        }
    </script>
</head>
<body onload="load()">
    <div id="content">
        <h1>SpaceX Booster List</h1>
        <ul id="list">
            <li>Loading Data</li>
        </ul>
        <div>
            <p>* Some core numbers are not known for early flights. The numbers shown are estimates based on flight order.</p>
        </div>
        <div class="imprint">
            <p>Made by niwax (<a href="https://twitter.com/niwasox">Twitter</a>, <a href="https://www.reddit.com/user/niwasox">Reddit</a>, <a href="https://forum.nasaspaceflight.com/index.php?action=profile;u=55527">NSF</a>) using the <a href="https://github.com/r-spacex/SpaceX-API">r/spacex API</a></p>
        </div>
    </div>
</body>
</html>
